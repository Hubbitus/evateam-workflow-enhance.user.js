# Заменяем встроенное представление процессов EvaTeam на продвинутое

В [EvaTeam](https://evateam.ru) на странице задач вроде https://eva.gid.team/project/Task/DATA-5945 есть кнопка отображения Workflow.

По ней открывается схема, которая выглядит примерно так: makets/maket-workflow.as-is.png.
HTML код данного блока (видимо без стилей) представлен в файле makets/maket.as-is.html.

Необходимо написать tampermonkey user.js script в файле evateam-workflow-enhance.user.js, который преобразовывает это представление и модернизирует его!

# Основные требования:
1. Все элементы должны быть перетаскиваемыми (dragable).
2. Предлагаю использовать для отображения [reactflow](https://reactflow.dev).
3. Изначально нужно предложить автоматическое расположение блоков, так чтобы блоки по возможности не пересекались и диаграмма была бы читаемой.
4. Если пользователь поменял расположение блоков, это должно сохраняться в локальном хранилище браузера (например localStorage) и восстанавливаться при последующем открытии этого же воркфлоу.
   * При этом стоит сохранять какой-то хеш воркфлоу, и если он изменится подтянуть изменения, даже если это где-то изменит положения
   * Постараться максимально сохранить то что было вручную упорядочено пользователем (не двигать блоки, которые не менялись).
5. Пример макета можно посмотреть в файле makets/maket.to-be.png.
   * В целом, цвета лучше оставить в цветовой гамме EvaTeam
   * Но для блоков и стрелок можно использовать дополнительные цвета, соблюдая цветовую гамму
   * Подписи стрелок и блоков берём из исходной диаграммы
6. В Tampermonkey-скрипте зависимости подкгружаем через директиву @require в заголовке, указывая ссылку на CDN.
7. Страницы на которых должен работать скрипт: `@match https://eva.gid.team/project/Task/*`
8. Исходное отображение, должно остаться и быть доступно на вкладке (tab) "Исходный workflow"
   * Должна быть возможность переключения пользователя между вкладками.
9. Если структура исходного workflow на странице окажется неожиданной или повреждённой, скрипт не должен "падать". В этом случае следует отобразить сообщение об ошибке на месте новой диаграммы, с возможностью показать вкладку с исходным workflow.

# Dev
Для целей разработки будем делать makets/dev.htm файл, чтобы он моделировал загрузку и работу, без необходимости каждый раз инсталлировать tampermonkey скрипт.

Так, теперь давай прототипировать дальше.
Весь основной код (парсинг исходного HTML, построение схемы, события, логика) выносим в отдельный файл HuEvaFlowEnhancer.js.
Внутри это всё размещаем в классе HuEvaFlowEnhancer.
Далее, этот файл подключаем в dev.html просто как <script src="http://localhost:3002/HuEvaFlowEnhancer.js">, а в tampermonkey скрипте `evateam-workflow-enhance.user.js` через `@require` по этому же адресу пока.
Это будет режим для разработки.

Добавь также "скрипт сборки" чтобы этот класс заэмбеддить в итоговый, скажем аппендя в конец. Опиши его в README.md, как и флоу что это так работает.

