<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvaTeam Workflow Enhancer - Development Mode</title>
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    <style>
      html, body {
        height: 100%;
        margin: 0;
      }
    </style>
</head>
<body>
    <!--
    Эмулируем для разработки скрипт встраивания в страницу.
    Т.к. в итоге мы разрабатываем UserScript, он должен будет работать в уже имеющейся странице, а не отдельным приложением!
    В блоке <div class="cdk-global-overlay-wrapper"> спустя секунду, будет добавлен блок <div id="cdk-overlay-1">, так, как он будет появляться в
    на таргет странице!
    Наше приложение, подгружаемое ниже как main.js, должно:
    1. Зарегистрировать MutationObserver, отслеживающий появление такого блока
        - При этом, используем именно MutationObserver, а не setInterval и поллинг! Мы не должны создавать лишней нагрузки, на странице этого блока может и не появиться!
    2. При появлении этого блока, на его месте (вместо него), запустить наше Svelte приложение, которое:
        * Отрисует 2 вкладки: "Улучшенный workflow" и "Оригинальный workflow"
        * Во второй вкладке "Оригинальный workflow" должен быть представлен именно этот появившийся и заменяемый блок, "как есть"
        * А в первой "Улучшенный workflow", добавляем его улучшенную версию, с получением данных по API, и с отрисовкой на SvelteFlow!
          Этот флоу должен отображать логически то же самое, но красивее, элементы перетаскиваемые, стрелки плавные, расположение блоков автоматическое!
    -->
    <div class="cdk-global-overlay-wrapper" dir="ltr" style="position: fixed; top: 1%; left: 1%; width: 98%; height: 98%; display: flex; align-items: center; justify-content: center; overflow: auto; background: rgba(255,255,255,0.1);">
    </div>

    <script>
        // Загрузка workflow. Для дев грузим из файла makets/maket.as-is.html в блок <div class="cdk-global-overlay-wrapper">. Грузим как есть, со стилями.
        setTimeout(function(){
            console.log('HuEvaFlowEnhancer: fetching workflow example');
            fetch('/maket.as-is.html')
                .then(response => response.text())
                .then(html => {
                    console.log('HuEvaFlowEnhancer: document received, inserting into wrapper');

                    // Insert the HTML into the wrapper
                    const wrapper = document.querySelector('.cdk-global-overlay-wrapper');
                    wrapper.innerHTML = html;

                    // Move all <style> tags from wrapper to document head so they apply globally
                    const styles = wrapper.querySelectorAll('style');
                    styles.forEach(style => {
                        document.head.appendChild(style);
                    });
                })
                .catch(error => {
                    console.error('HuEvaFlowEnhancer: Error loading workflow HTML:', error);
                });
            }
            , 1000
        );
    </script>

    <!-- Load the development application -->
    <script type="module" src="./main.js"></script>
</body>
</html>